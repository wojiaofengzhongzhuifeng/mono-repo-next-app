# Admin API Backend

åŸºäº Next.js API Routes çš„ç®¡ç†åç«¯ APIï¼Œç”¨äºç®¡ç†æ•°å­—è®¡æ•°æ•°æ®ã€‚

## ğŸš€ API ç«¯ç‚¹

### æ•°å­—ç®¡ç†

- `GET /api/admin/numbers` - è·å–æ‰€æœ‰æ•°å­—è®°å½•
- `POST /api/admin/numbers` - åˆ›å»ºæ–°çš„æ•°å­—è®°å½•
- `GET /api/admin/numbers/[id]` - è·å–å•ä¸ªæ•°å­—è®°å½•
- `PUT /api/admin/numbers/[id]` - æ›´æ–°æ•°å­—è®°å½•
- `DELETE /api/admin/numbers/[id]` - åˆ é™¤æ•°å­—è®°å½•

### ç»Ÿè®¡ä¿¡æ¯

- `GET /api/admin/stats` - è·å–ç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

### ç¯å¢ƒå˜é‡è®¾ç½®

1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼š

   ```bash
   cp .env.example .env.local
   ```

2. åœ¨ `.env.local` ä¸­é…ç½®ä½ çš„ Supabase å‡­æ®ï¼š
   ```env
   NEXT_PUBLIC_SUPABASE_URL=https://your-project-id.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=your_service_role_key_here
   ```

### å®‰è£…å’Œè¿è¡Œ

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# æ„å»ºé¡¹ç›®
pnpm build

# è¿è¡Œç”Ÿäº§æœåŠ¡å™¨
pnpm start
```

## ğŸ“¦ Vercel éƒ¨ç½²

### 1. å‡†å¤‡éƒ¨ç½²

ç¡®ä¿ä½ å·²ç»ï¼š

- é…ç½®å¥½äº† Supabase é¡¹ç›®
- è·å–äº† Service Role Key

### 2. Vercel ç¯å¢ƒå˜é‡é…ç½®

åœ¨ Vercel Dashboard ä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| å˜é‡å                      | å€¼                     | è¯´æ˜     |
| --------------------------- | ---------------------- | -------- |
| `NEXT_PUBLIC_SUPABASE_URL`  | ä½ çš„ Supabase é¡¹ç›® URL | å…¬å¼€å˜é‡ |
| `SUPABASE_SERVICE_ROLE_KEY` | ä½ çš„ Service Role Key  | ç§å¯†å˜é‡ |

### 3. éƒ¨ç½²æ­¥éª¤

#### æ–¹æ³• 1: Vercel CLI

```bash
# å®‰è£… Vercel CLI
npm i -g vercel

# ç™»å½• Vercel
vercel login

# éƒ¨ç½²é¡¹ç›®
vercel --prod
```

#### æ–¹æ³• 2: GitHub é›†æˆ

1. å°†ä»£ç æ¨é€åˆ° GitHub
2. åœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
3. é…ç½®ç¯å¢ƒå˜é‡
4. è‡ªåŠ¨éƒ¨ç½²

### 4. éƒ¨ç½²åæµ‹è¯•

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl https://your-app.vercel.app/api/admin/stats

# æµ‹è¯•è·å–æ‰€æœ‰è®°å½•
curl https://your-app.vercel.app/api/admin/numbers
```

## ğŸ“Š æ•°æ®åº“è¡¨ç»“æ„

ç¡®ä¿ä½ çš„ Supabase æ•°æ®åº“ä¸­æœ‰ä»¥ä¸‹è¡¨ç»“æ„ï¼š

```sql
CREATE TABLE numbers (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  value BIGINT NOT NULL,
  label TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'inactive')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **Service Role Key**: ç»ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ä½¿ç”¨ Service Role Key
2. **ç¯å¢ƒå˜é‡**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ‰€æœ‰æ•æ„Ÿä¿¡æ¯éƒ½åº”è¯¥é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
3. **RLS ç­–ç•¥**: è€ƒè™‘åœ¨ Supabase ä¸­è®¾ç½® Row Level Security ç­–ç•¥

## ğŸš¨ é”™è¯¯å¤„ç†

API è¿”å›ç»Ÿä¸€çš„é”™è¯¯æ ¼å¼ï¼š

```json
{
  "success": false,
  "error": "é”™è¯¯æè¿°"
}
```

## ğŸ“ è¯·æ±‚/å“åº”ç¤ºä¾‹

### åˆ›å»ºè®°å½•

```bash
curl -X POST https://your-app.vercel.app/api/admin/numbers \
  -H "Content-Type: application/json" \
  -d '{
    "value": 100,
    "label": "æµ‹è¯•æ•°å­—",
    "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ•°å­—",
    "status": "active"
  }'
```

### å“åº”

```json
{
  "success": true,
  "data": {
    "id": 1,
    "value": 100,
    "label": "æµ‹è¯•æ•°å­—",
    "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ•°å­—",
    "status": "active",
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  },
  "message": "Number created successfully"
}
```
